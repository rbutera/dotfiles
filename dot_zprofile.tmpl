#
# Executes commands at login pre-zshrc.
#

export LANG=en_US.UTF-8

#
# Paths - set early so tools are available
#

# Homebrew/Linuxbrew
{{ if eq .chezmoi.os "darwin" }}
if [[ -f /opt/homebrew/bin/brew ]]; then
  eval "$(/opt/homebrew/bin/brew shellenv)"
elif [[ -f /usr/local/bin/brew ]]; then
  eval "$(/usr/local/bin/brew shellenv)"
fi
{{ else }}
if [[ -f /home/linuxbrew/.linuxbrew/bin/brew ]]; then
  eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"
elif [[ -f $HOME/.linuxbrew/bin/brew ]]; then
  eval "$($HOME/.linuxbrew/bin/brew shellenv)"
fi
{{ end }}

# bob-nvim
export PATH="$HOME/.local/share/bob/nvim-bin:$PATH"

# Rust/Cargo
export PATH="$HOME/.cargo/bin:$PATH"

# Go
export GOPATH="$HOME/go"
export PATH="$PATH:$GOPATH/bin"

# pnpm
{{ if eq .chezmoi.os "darwin" }}
export PNPM_HOME="$HOME/Library/pnpm"
{{ else }}
export PNPM_HOME="$HOME/.local/share/pnpm"
{{ end }}
export PATH="$PNPM_HOME:$PATH"

# Local bin
export PATH="$HOME/.local/bin:$PATH"
export PATH="$HOME/bin:$PATH"

#
# Editors
#

export EDITOR='nvim'
export VISUAL='nvim'
export SUDO_EDITOR='nvim'
export PAGER='less'
export MANPAGER="sh -c 'col -bx | bat -l man -p'"

#
# Browser
#

{{ if eq .chezmoi.os "darwin" }}
export BROWSER='open'
{{ else if .wsl }}
export BROWSER='wslview'
export PATH="$PATH:/mnt/c/Windows/System32:/mnt/c/Windows/System32/WindowsPowerShell/v1.0"
{{ end }}

#
# Language
#

if [[ -z "$LANG" ]]; then
  export LANG='en_US.UTF-8'
fi

#
# Paths - additional
#

# Ensure path arrays do not contain duplicates
typeset -gU cdpath fpath mailpath path

path=(
  /usr/local/{bin,sbin}
  $path
)

[ -d "$HOME/.nodenv/bin" ] && path+=($HOME/.nodenv/bin)
[ -d "$HOME/.pyenv/bin" ] && path+=($HOME/.pyenv/bin)
[ -d "$HOME/.poetry/bin" ] && path+=($HOME/.poetry/bin)

#
# Less
#

export LESS='-g -i -M -R -S -w -X -z-4'

if (( $#commands[(i)lesspipe(|.sh)] )); then
  export LESSOPEN="| /usr/bin/env $commands[(i)lesspipe(|.sh)] %s 2>&-"
fi

#
# FZF
#

export FZF_DEFAULT_OPTS="--color=bg+:#313244,bg:#1e1e2e,spinner:#f5e0dc,hl:#f38ba8 --color=fg:#cdd6f4,header:#f38ba8,info:#cba6f7,pointer:#f5e0dc --color=marker:#f5e0dc,fg+:#cdd6f4,prompt:#cba6f7,hl+:#f38ba8"
[ -f ~/.fzf.zsh ] && source ~/.fzf.zsh

#
# Misc
#

setopt NO_NOMATCH
export CHEZMOI_DIR="$HOME/.local/share/chezmoi"

{{- if eq .chezmoi.os "linux" }}
export COLORTERM=fullcolor
export XDG_CONFIG_HOME="$HOME/.config"
{{ end }}

{{ if eq .chezmoi.os "darwin" }}
# OrbStack
source ~/.orbstack/shell/init.zsh 2>/dev/null || :
{{ end }}

{{ if eq .chezmoi.os "linux" }}
{{ if or (eq .chezmoi.osRelease.id "arch") (eq .chezmoi.osRelease.idLike "arch") }}
export MOZ_ENABLE_WAYLAND=1
export XDG_DATA_DIRS="$XDG_DATA_DIRS:/var/lib/flatpak/exports/share"
export PATH="/usr/lib/ccache/bin/:$PATH"
{{ end }}
{{ end }}
