#!/bin/bash
# Cross-platform clipboard paste

# 1. SSH session: OSC 52 paste is not reliably supported
if [[ -n "$SSH_CONNECTION" ]]; then
  echo "pbpaste: clipboard paste not supported over SSH" >&2
  exit 1
fi

# 2. macOS native (use full path to avoid recursion)
if [[ -x /usr/bin/pbpaste ]]; then
  /usr/bin/pbpaste
  exit 0
fi

# 3. WSL2: use powershell.exe
if command -v powershell.exe &> /dev/null; then
  powershell.exe -NoProfile -Command Get-Clipboard | tr -d '\r'
  exit 0
fi

# 4. Wayland: use wl-paste
if [[ -n "$WAYLAND_DISPLAY" ]] && command -v wl-paste &> /dev/null; then
  wl-paste
  exit 0
fi

# 5. X11: use xclip
if command -v xclip &> /dev/null; then
  xclip -selection clipboard -o
  exit 0
fi

# 6. X11: use xsel
if command -v xsel &> /dev/null; then
  xsel --clipboard --output
  exit 0
fi

echo "pbpaste: no clipboard tool available" >&2
exit 1
